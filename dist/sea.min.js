String.prototype.uncapitalize=function(){return this.charAt(0).toLowerCase()+this.slice(1)};var SeaORM=function(a){"use strict";var b,c={},d=function(a,b){Object.defineProperty(a,b,{get:function(){return a.get(b)},set:function(c){a.set(b,c)},enumerable:!0,configurable:!1})},e=function(){var c={},e=1,g=function(b,f,g){var h=this;Object.defineProperty(h,"_id",{value:e++,writable:!1,enumerable:!1,configurable:!1}),Object.defineProperty(h,"_resource",{value:f,writable:!1,enumerable:!1,configurable:!1}),Object.defineProperty(h,"$promise",{value:void 0,writable:!0,enumerable:!1,configurable:!1}),Object.defineProperty(h,"$calling",{value:!1,writable:!0,enumerable:!1,configurable:!1}),c[this._id]={fields:a.extend({id:0},b.fields),resourceObject:null},Object.defineProperty(h,"$isNew",{get:function(){return 0==c[h._id].fields.id},enumerable:!1,configurable:!1}),Object.defineProperty(h,"$isLoaded",{get:function(){return 0!=c[h._id].fields.id&&null!==c[h._id].resourceObject},enumerable:!1,configurable:!1}),"object"==typeof g?h.setFields(g):"function"!=typeof g&&g&&h.set("id",g);for(var i in c[this._id].fields){for(;"function"==typeof c[this._id].fields[i];)c[this._id].fields[i]=c[this._id].fields[i](this),"object"==typeof g&&g[i]&&h.set(i,g[i]);d(this,i)}},h=function(a){c[a._id].resourceObject.id=a.getId()};return g.prototype.getId=function(){return c[this._id].fields.id},g.prototype.setId=function(a){c[this._id].fields.id=a,this.$isLoaded&&(c[this._id].resourceObject.id=a)},g.prototype.toJS=function(){var a={};for(var b in c[this._id].fields)null!=c[this._id].fields[b]&&c[this._id].fields[b]instanceof f?a[b]=c[this._id].fields[b].toJS():a[b]=c[this._id].fields[b];return a.id=this.getId(),a},g.prototype.toJSON=function(){return JSON.stringify(this.toJS())},g.prototype.get=function(b,d,e){return"id"===b?this.getId():"string"==typeof b&&b in c[this._id].fields?null!=c[this._id].fields[b]&&c[this._id].fields[b]instanceof f?c[this._id].fields[b].get(d,e):c[this._id].fields[b]:a.copy(c[this._id].fields)},g.prototype.set=function(a,b){"id"===a&&this.setId(b),"string"==typeof a&&a in c[this._id].fields?null!=c[this._id].fields[a]&&c[this._id].fields[a]instanceof f?(c[this._id].fields[a].set(b),this.$isLoaded&&(c[this._id].resourceObject[a]=c[this._id].fields[a].toJS())):"function"!=typeof c[this._id].fields[a]&&(c[this._id].fields[a]=b,this.$isLoaded&&(c[this._id].resourceObject[a]=b)):"object"==typeof a&&this.setFields(a)},g.prototype.setFields=function(a){if("object"==typeof a)for(var b in a)this.set(b,a[b])},g.prototype.load=function(a,d){var e=this,f=b.defer();return c[e._id].resourceObject=e._resource.get({id:e.id},function(b,c){e.set(b),"function"==typeof a&&a(e,c),e.$calling=!1,f.resolve(e,c)},function(a){"function"==typeof d&&d(a),e.$calling=!1,f.reject(a)}),e.$calling=!0,e.$promise=f.promise},g.prototype.save=function(a,d){var e=this,f=b.defer();if(e.$isLoaded)h(e);else{var g=e.toJS();e.$isNew&&delete g.id,c[e._id].resourceObject=new e._resource(g)}var i=function(b,d){e.set(c[e._id].resourceObject),"function"==typeof a&&a(e,d),e.$calling=!1,f.resolve(e,d)},j=function(a){"function"==typeof d&&d(a),e.$calling=!1,f.reject(a)};return e.$isNew?c[e._id].resourceObject.$create(i,j):c[e._id].resourceObject.$update(i,j),e.$calling=!0,e.$promise=f.promise},g.prototype.remove=function(a,d){var e=this,f=b.defer();return e.$isNew?void 0:(e.$isLoaded||(c[e._id].resourceObject=new e._resource(e.toJS())),h(e),c[e._id].resourceObject.$remove(function(b,c){"function"==typeof a&&a(e,c),e.$calling=!1,f.resolve(e,c)},function(a){"function"==typeof d&&d(a),e.$calling=!1,f.reject(a)}),e.$calling=!0,e.$promise=f.promise)},g}(),f=function(){var a=function(a,b){this.object=null,this.model=a,this.instance=b};return a.prototype.get=function(a,b){},a.prototype.set=function(a){},a.prototype.toJS=function(){},a}(),g=function(){var a=function(a,b){f.call(this,a,b)};return a.prototype=Object.create(f.prototype),a.prototype.constructor=a,a.prototype.toJS=function(){return f.prototype.toJS.call(this),this.object?this.object.id:null},a.prototype.get=function(a,b){return f.prototype.get.call(this,a,b),!this.object||this.object.$isNew||this.object.$isLoaded?"function"==typeof a&&a(this.object):this.object.load(a,b),this.object},a.prototype.set=function(a){f.prototype.set.call(this,a),null===a||a instanceof this.model?this.object=a:"functoin"==typeof a||!a||null!=this.object&&this.object.id==a||(this.object=new this.model({id:a}))},a}(),h=function(){var a=function(a,b,c){f.call(this,a,b),this.related_field=c,this.$isLoaded=!1,this.loading_success_cb=[],this.loading_error_cb=[]};return a.prototype=Object.create(f.prototype),a.prototype.constructor=a,a.prototype.execute_success_cb=function(a,b){for(var c=0;c<this.loading_success_cb.length;c++)this.loading_success_cb[c](a,b);this.loading_success_cb=[],this.loading_error_cb=[]},a.prototype.execute_error_cb=function(a){for(var b=0;b<this.loading_error_cb.length;b++)this.loading_error_cb[b](a);this.loading_success_cb=[],this.loading_error_cb=[]},a.prototype.register_callbacks=function(a,b){"function"==typeof a&&this.loading_success_cb.push(a),"function"==typeof b&&this.loading_error_cb.push(b)},a.prototype.toJS=function(){if(f.prototype.toJS.call(this),!this.object)return null;for(var a=[],b=0;b<this.object.length;b++)a.push(this.object[b].id);return a},a.prototype.has_object=function(a){if(!this.object)return!1;for(var b=0;b<this.object.length;b++)if(this.object[b].id==a)return!0;return!1},a.prototype.get=function(a,b){f.prototype.get.call(this,a,b);var c=this;if(!c.object){var d={};d[c.related_field]=c.instance.id,c.object=c.model.query(d,function(a,b){c.$isLoaded=!0,c.execute_success_cb(a,b)},function(a){c.execute_error_cb(a)})}return c.register_callbacks(a,b),c.$isLoaded&&c.execute_success_cb(c.object),c.object},a.prototype.set=function(a){if(f.prototype.set.call(this,a),a instanceof this.model)this.object||(this.object=[],this.$isLoaded=!0),this.has_object(a.id)||this.object.push(a);else if(a instanceof Array){var b=[],c={};this.object=b;for(var d=0;d<a.length;d++)a[d]instanceof this.model&&!c[a[d].id]&&(b.push(a[d]),c[a[d].id]=!0);this.$isLoaded=!0}else null===a?(this.object=null,this.$isLoaded=!1):"function"!=typeof a&&a&&(this.object||(this.object=[],this.$isLoaded=!0),this.has_object(a)||this.object.push(new this.model({id:a})))},a}(),i=function(d,f,i){b=f;var j=this,k={endpointPrefix:"",endpoint:function(a){return"/"+a.uncapitalize()+"/:id/"},methods:{get:{method:"GET"},create:{method:"POST"},update:{method:"PUT"},query:{method:"GET",isArray:!0},remove:{method:"DELETE"},delete:{method:"DELETE"}}};this.config=function(b){return"object"!=typeof b?k:(a.extend(k,b),j)},this.prefixedEndpoint=function(a,b){if("object"!=typeof a)throw"config should be an object";if("object"!=typeof b)throw"declaration should be an object";var c=a.endpointPrefix||"",d=b.endpoint||"";return d||("function"==typeof a.endpoint?d=a.endpoint(b.name):"string"==typeof a.endpoint&&(d=a.endpoint)),c+d},this.newModel=function(f,g){if("object"!=typeof f)throw"declaration should be an object";if("string"!=typeof f.name)throw"declaration should define a string name attribute";"object"!=typeof g&&(g={}),g=a.extend({},k,g);var h=j.prefixedEndpoint(g,f),i=d(h,{id:"@id"},g.methods),l=function(){var a=Array.prototype.slice.call(arguments);a.unshift(f,i),e.apply(this,a)};l.prototype=Object.create(e.prototype),l.prototype.constructor=l,Object.defineProperty(l.prototype,"$endpoint",{value:h,writable:!1,enumerable:!1,configurable:!1}),Object.defineProperty(l.prototype,"$modelName",{value:f.name,writable:!1,enumerable:!1,configurable:!1});for(var m in f.methods)"function"==typeof f.methods[m]&&(l.prototype[m]=f.methods[m]);return l.query=function(a,c,d){"function"==typeof a&&(d=c,c=a,a={});var e=[],f=b.defer(),g=null,h=i.query(a,function(a,b){for(var d=0;d<h.length;d++)g=new l(h[d]),e.push(g);"function"==typeof c&&c(e,b),e.$calling=!1,f.resolve(e,b)},function(a){"function"==typeof d&&d(a),e.$calling=!1,f.reject(a)});return e.$promise=f.promise,e.$calling=!0,e},l.get=function(a,b,c){if(!a)throw"id argument is required";var d=new l({id:a});return d.load(b,c),d},c[f.name]=l,l},this.belongsTo=function(a){if(void 0===a||null===a||!(a.prototype instanceof e)&&"string"!=typeof a)throw"Invalid model parameter. It should be a string or Sea Model!";return function(b){return"string"==typeof a?new g(c[a],b):new g(a,b)}},this.hasMany=function(a,b){if(void 0===a||null===a||!(a.prototype instanceof e)&&"string"!=typeof a)throw"Invalid model parameter. It should be a string or Sea Model!";if("string"!=typeof b)throw"Invalid related_field parameter. It should be a string!";return function(d){return"string"==typeof a?new h(c[a],d,b):new h(a,d,b)}},this.config(i)};return a.module("seaModel",["ngResource"]).provider("$seaModel",function(){var b={};this.config=function(c){a.extend(b,c)},this.$get=["$resource","$q",function(a,c){return new i(a,c,b)}]}),i}(angular);
//# sourceMappingURL=sea.min.js.map